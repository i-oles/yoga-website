<div id="cancel-block-{{ .ID }}">
    <div id="book-button-{{ .ID }}">
        <button class="btn-book"
                hx-post="/book"
                hx-swap="outerHTML"
                hx-target="#cancel-block-{{ .ID }}"
                hx-vals='{"id": "{{ .ID }}"}'
                hx-trigger="click">
            book now
        </button>
    </div>
    <form id="cancel-form-{{ .ID }}"
          hx-post="/pending_operation/{{ .ID }}/cancel_booking"
          hx-target="#cancel-block-{{ .ID }}"
          hx-swap="outerHTML">

        <input type="hidden" name="class_id" value="{{ .ID }}">

        <label for="email-{{ .ID }}">Email:</label>
        <input type="email" id="email-{{ .ID }}" name="email" required class="form-input" pattern="[^@\s]+@[^@\s]+\.[^@\s]+"
            title="Please enter a valid email address">

        <div class="err-msg">
            {{ .Error }}
        </div>

        <button type="cancel" class="btn-cancel">
            <span class="submit-text">Cancel Booking</span>
            <span class="htmx-indicator">Processing...</span>
        </button>
    </form>
</div>
<script>
    document.addEventListener('htmx:beforeSwap', function(event) {
        // handle status 409 (Conflict), 400 (Bad Request), 404 (Not Found)
        if ([409, 404, 400].includes(event.detail.xhr.status)) {
            event.detail.shouldSwap = true;  // force swap
            event.detail.isError = false;    // treat as proper resp
        }
    });
</script>